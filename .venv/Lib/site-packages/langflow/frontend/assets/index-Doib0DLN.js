import{av as T,aw as D,ax as O,aV as ee,aW as se,aX as ae,aY as te,aZ as V,a_ as G,q as ne,aD as re,r as h,j as e,I as le,$ as v,aI as S,a$ as b,aL as N,aK as C,aJ as E,a as P,e as w,b0 as I,h as _,g as j,b1 as H,ai as oe,b2 as ie,c as ce,b3 as $,b4 as de,b5 as ue,b6 as he,b7 as me,i as pe,at as xe,b8 as fe,u as F,A as L,ae as m,ab as ge}from"./index-BMduUo-e.js";import{I as A}from"./index-DBQGxdl2.js";import"./input-0yNO_Rdy.js";import"./popover-Ig0gGBrk.js";const je=a=>{const{mutate:o}=T();return o(["usePostAddApiKey"],async s=>(await D.post(`${O("API_KEY")}/store`,{api_key:s.key})).data,a)},ye=()=>{const{query:a}=T(),o=async()=>(await D.get(`${O("FILES")}/profile_pictures/list`)).data;return a(["useGetProfilePicturesQuery"],async()=>{var i;const s=await o(),r={};return(i=s==null?void 0:s.files)==null||i.forEach(c=>{const[l,u]=c.split("/");r[l]?r[l].push(u):r[l]=[u]}),r},{placeholderData:ee})},Pe=(a,o,n)=>({handlePatchPassword:async(s,r,i)=>{var c,l;if(s!==r){n({title:se,list:[ae]});return}try{s!==""&&await te(a.id,{password:s}),i({target:{name:"password",value:""}}),i({target:{name:"cnfPassword",value:""}}),o({title:V})}catch(u){n({title:G,list:[(l=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:l.detail]})}}}),we=(a,o,n,d)=>({currentUserData:n,handlePatchProfilePicture:async r=>{var i,c;try{if(r!==""){await ne(n.id,{profile_image:r});let l=re(n);l.profile_image=r,d(l)}a({title:V})}catch(l){o({title:G,list:[(c=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:c.detail]})}}}),Ae=(a,o)=>{h.useEffect(()=>{const n=document.getElementById(a??"null");n&&n.scrollIntoView({behavior:"smooth"})},[a]),h.useEffect(()=>{o("")},[o])},ve=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(le,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),Se=({password:a,cnfPassword:o,handleInput:n,handlePatchPassword:d})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:s=>{d(a,o,n),s.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(b,{children:[e.jsx(N,{children:"Password"}),e.jsx(C,{children:"Type your new password and confirm it."})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(P,{name:"password",className:"w-full",children:[e.jsx(A,{id:"pasword",onChange:s=>{n({target:{name:"password",value:s}})},value:a,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(w,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(P,{name:"cnfPassword",className:"w-full",children:[e.jsx(A,{id:"cnfPassword",onChange:s=>{n({target:{name:"cnfPassword",value:s}})},value:o,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(w,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(_,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})}),be=(a,o,n)=>{const d=async s=>Promise.all(s.map(r=>new Promise(i=>{const c=new Image;c.src=r,c.onload=i,c.onerror=i})));h.useEffect(()=>{if(n||!a)return;const s=[];Object.keys(a).flatMap(r=>a[r].map(i=>s.push(`${H}files/profile_pictures/${r}/${i}`))),d(s).then(()=>{o(!0)})},[a,n])};function Ne({profilePictures:a,loading:o,value:n,onChange:d}){const s=h.useRef(null),r=oe(l=>l.dark),[i,c]=h.useState(!1);return h.useEffect(()=>{var l;n&&s&&((l=s.current)==null||l.scrollIntoView({behavior:"smooth",block:"center"}))},[s,n]),be(a,c,o),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:o||!i?e.jsx(ie,{}):Object.keys(a).map((l,u)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:l})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:a[l].map((p,y)=>e.jsx(j,{ref:n===l+"/"+p?s:void 0,unstyled:!0,onClick:()=>d(l+"/"+p),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${H}files/profile_pictures/${l+"/"+p}`,style:{filter:n===l+"/"+p?r?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:ce("h-12 w-12")},y)}))})})]}))})}const Ce=({profilePicture:a,handleInput:o,handlePatchProfilePicture:n,handleGetProfilePictures:d,userData:s})=>{const{data:r,isFetching:i}=d;return e.jsx(v,{onSubmit:c=>{n(a),c.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(b,{children:[e.jsx(N,{children:"Profile Picture"}),e.jsx(C,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(E,{children:e.jsx("div",{className:"py-2",children:e.jsx(Ne,{profilePictures:r,loading:i,value:a==""?(s==null?void 0:s.profile_image)??$[parseInt((s==null?void 0:s.id)??"",30)%$.length]:a,onChange:c=>{o({target:{name:"profilePicture",value:c}})}})})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(_,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})},Ee=({apikey:a,handleInput:o,handleSaveKey:n,loadingApiKey:d,validApiKey:s,hasApiKey:r})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:i=>{i.preventDefault(),n(a,o)},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(b,{children:[e.jsx(N,{children:"Store API Key"}),e.jsx(C,{children:(r&&!s?de:r?"":ue)+he})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(P,{name:"apikey",className:"w-full",children:[e.jsx(A,{id:"apikey",onChange:i=>{o({target:{name:"apikey",value:i}})},value:a,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(w,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[me," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(_,{asChild:!0,children:e.jsx(j,{loading:d,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Re=()=>{const a=pe(t=>t.setCurrentFlowId),{scrollId:o}=xe(),[n,d]=h.useState(fe),s=F(t=>t.setSuccessData),r=F(t=>t.setErrorData),{userData:i,setUserData:c}=h.useContext(L),l=m(t=>t.hasStore),u=m(t=>t.validApiKey),p=m(t=>t.hasApiKey),y=m(t=>t.loadingApiKey),{password:M,cnfPassword:U,profilePicture:Y,apikey:q}=n,B=ge(t=>t.autoLogin),{storeApiKey:W}=h.useContext(L),K=m(t=>t.updateHasApiKey),k=m(t=>t.updateValidApiKey),R=m(t=>t.updateLoadingApiKey),{handlePatchPassword:Q}=Pe(i,s,r),z=ye(),{handlePatchProfilePicture:J}=we(s,r,i,c);Ae(o,a);const{mutate:X}=je({onSuccess:()=>{s({title:"API key saved successfully"}),K(!0),k(!0),R(!1),x({target:{name:"apikey",value:""}})},onError:t=>{var f,g;r({title:"API key save error",list:[(g=(f=t==null?void 0:t.response)==null?void 0:f.data)==null?void 0:g.detail]}),K(!1),k(!1),R(!1)}}),Z=t=>{t&&(X({key:t}),W(t))};function x({target:{name:t,value:f}}){d(g=>({...g,[t]:f}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(ve,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ce,{profilePicture:Y,handleInput:x,handlePatchProfilePicture:J,handleGetProfilePictures:z,userData:i}),!B&&e.jsx(Se,{password:M,cnfPassword:U,handleInput:x,handlePatchPassword:Q}),l&&e.jsx(Ee,{apikey:q,handleInput:x,handleSaveKey:Z,loadingApiKey:y,validApiKey:u,hasApiKey:p})]})]})};export{Re as GeneralPage,Re as default};
