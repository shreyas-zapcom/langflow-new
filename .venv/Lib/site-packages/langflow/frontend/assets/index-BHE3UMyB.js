import{b0 as ue,b1 as me,b2 as de,j as s,r as h,h as f,aT as J,aU as Q,aO as X,ax as v,b9 as Y,aR as Z,I as c,by as pe,u as G,ag as xe,af as L,S as b,aQ as he,ba as fe,f as N,bc as K,bz as we}from"./index-CZbEahd3.js";import{S as P,I as ge}from"./index-DKGNVKDd.js";import{D as je}from"./index-5_djxRHe.js";import{C as be}from"./checkbox-C-sC8C-t.js";import{c as ve,e as ye}from"./form-Dzk1BESV.js";import{I as ke}from"./input-Be_w8K09.js";const Ne=e=>{const{mutate:t}=ue();return t(["usePostLikeComponent"],async i=>{const{componentId:o}=i;return await me.post(`${de("STORE")}/users/likes/${o}`)},e)},Ue=()=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-card-wrapper",children:[s.jsx(P,{className:"h-8 w-8 rounded-full"}),s.jsx(P,{className:"h-4 w-[40%]"})]}),s.jsxs("div",{className:"skeleton-card-text",children:[s.jsx(P,{className:"h-3 w-[90%]"}),s.jsx(P,{className:"h-3 w-[80%]"})]})]}),Ce=(e,t,a,l)=>{h.useEffect(()=>{e&&(t((e==null?void 0:e.liked_by_user)??!1),a((e==null?void 0:e.liked_by_count)??0),l((e==null?void 0:e.downloads_count)??0))},[e,e==null?void 0:e.liked_by_count,e==null?void 0:e.liked_by_user,e==null?void 0:e.downloads_count])},Se=Ce,Ie=(e,t,a,l,i,o,u,m)=>{const w=f(y=>y.addFlow);return{handleInstall:()=>{const y=l;i(g=>Number(g)+1),o(!0),J(e.id).then(g=>{const $=Q(g,g.id,e.is_component);w(!0,$).then(j=>{u({title:`${t} Installed Successfully.`}),o(!1)}).catch(j=>{o(!1),m({title:`Error installing the ${t}`,list:[j.response.data.detail]})})}).catch(g=>{o(!1),m({title:`Error installing the ${t}`,list:[g.response.data.detail]}),i(y)})}}},_e=Ie;function Fe({data:e}){return s.jsx(s.Fragment,{children:s.jsx(X,{draggable:!0,className:v("group relative flex flex-col justify-between overflow-hidden transition-all hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#ffffff10]"),children:s.jsx("div",{children:s.jsx(Y,{children:s.jsx("div",{children:s.jsxs(Z,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(c,{className:v("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx("div",{className:"w-full truncate pr-3",children:e.name})]})})})})})})}const Pe=e=>{const t=f(l=>l.getFlowById);return{onDragStart:h.useCallback(l=>{let i=s.jsx(Fe,{data:e});const o=document.createElement("div");o.style.transform="translate(-10000px, -10000px)",o.style.position="absolute",document.body.appendChild(o),l.dataTransfer.setDragImage(o,0,0),pe(o).render(i),t(e.id)&&l.dataTransfer.setData("flow",JSON.stringify(e))},[e])}},$e=Pe,De=(e,t,a,l,i,o,u)=>{h.useEffect(()=>{var m,w;e&&t&&(a?(i(((m=l==null?void 0:l.data)==null?void 0:m.nodes)??[],!0),o(((w=l==null?void 0:l.data)==null?void 0:w.edges)??[],!0)):(i([],!0),o([],!0)),u())},[a])},Ee=De;function W(e){return e.replace(/ /g,"-").toLowerCase()}function qe({data:e,authorized:t=!0,disabled:a=!1,button:l,onClick:i,onDelete:o,playground:u,control:m}){var H;const w=G(n=>n.setSuccessData),x=G(n=>n.setErrorData),y=xe(n=>n.updateValidApiKey),g=L(n=>n.CleanFlowPool),$=!1,[j,z]=h.useState(!1),[C,S]=h.useState((e==null?void 0:e.liked_by_user)??!1),[T,I]=h.useState((e==null?void 0:e.liked_by_count)??0),[B,O]=h.useState((e==null?void 0:e.downloads_count)??0),ee=f(n=>n.currentFlow),A=f(n=>n.setCurrentFlow),M=f(n=>n.getFlowById),se=f(n=>n.currentFlowId),ne=L(n=>n.setNodes),te=L(n=>n.setEdges),[D,k]=h.useState(!1),R=f(n=>n.setCurrentFlowId),[_,d]=h.useState(!1),E=f(n=>n.selectedFlowsComponentsCards),U=e.is_component?"Component":"Flow";async function q(){const n=await J(e.id);return Q(n,n.id,e.is_component,!0)}function F(n){var V;if(!n)return!1;const{inputs:p,outputs:r}=we(((V=n==null?void 0:n.data)==null?void 0:V.nodes)??[]);return p.length>0||r.length>0}Ee(se,u,D,ee,ne,te,g),Se(e,S,I,O);const{handleInstall:oe}=_e(e,U,$,B,O,z,w,x),{mutate:le,isPending:re}=Ne(),ie=()=>{if(C!==void 0||C!==null){const n=C,p=T;S(r=>!r),I(r=>n?r-1:r+1),le({componentId:e.id},{onSuccess:r=>{I(r.data.likes_count),S(r.data.liked_by_user)},onError:r=>{if(I(p),S(n),r.response.status===403)return y(!1);console.error(r),x({title:`Error liking ${U}.`,list:[r.response.data.detail]})}})}},ce=(E==null?void 0:E.includes(e==null?void 0:e.id))??!1,{onDragStart:ae}=$e(e);return s.jsxs(s.Fragment,{children:[s.jsxs(X,{onDragStart:ae,draggable:!0,"data-testid":`card-${W(e.name)}`,className:v("group relative flex h-[11rem] flex-col justify-between overflow-hidden",!e.is_component&&"hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#5f5f5f0e]",a?"pointer-events-none opacity-50":"",i?"cursor-pointer":"",ce?"border border-selected":""),onClick:i,children:[s.jsx("div",{children:s.jsxs(Y,{children:[s.jsx("div",{children:s.jsxs(Z,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(c,{className:v("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx(b,{content:e.name,children:s.jsx("div",{className:"w-full truncate pr-3",children:e.name})}),(e==null?void 0:e.metadata)!==void 0&&s.jsxs("div",{className:"flex items-center gap-3",children:[e.private&&s.jsx(b,{content:"Private",children:s.jsx("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:s.jsx(c,{name:"Lock",className:"h-4 w-4"})})}),!e.is_component&&s.jsx(b,{content:"Components",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(c,{name:"ToyBrick",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`total-${e.name}`,children:((H=e==null?void 0:e.metadata)==null?void 0:H.total)??0})]})}),s.jsx(b,{content:"Likes",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(c,{name:"Heart",className:v("h-4 w-4")}),s.jsx("span",{"data-testid":`likes-${e.name}`,children:T??0})]})}),s.jsx(b,{content:"Downloads",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(c,{name:"DownloadCloud",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`downloads-${e.name}`,children:B??0})]})})]}),m&&s.jsx("div",{className:"flex",onClick:n=>{n.stopPropagation()},children:s.jsx(ve,{control:m,name:`${e.id}`,defaultValue:!1,render:({field:n})=>s.jsx(ye,{children:s.jsx(be,{"data-testid":"checkbox-component","aria-label":"checkbox-component",checked:n.value,onCheckedChange:n.onChange,className:"h-5 w-5 border border-ring data-[state=checked]:border-selected data-[state=checked]:bg-selected"})})})})]})}),s.jsxs("div",{className:"flex gap-2",children:[e.user_created&&e.user_created.username&&s.jsxs("span",{className:"text-sm text-primary",children:["by ",s.jsx("b",{children:e.user_created.username}),e.last_tested_version&&s.jsxs(s.Fragment,{children:[" ","|"," ",s.jsxs("span",{className:"text-xs",children:[" ","⛓︎ v",e.last_tested_version]})]})]}),s.jsx("div",{className:"flex w-full flex-1 flex-wrap gap-2"})]}),s.jsx(he,{className:"pb-2 pt-2",children:s.jsx("div",{className:(e==null?void 0:e.metadata)!==void 0?"truncate":"truncate-doubleline",children:e.description})})]})}),s.jsx(fe,{children:s.jsx("div",{className:"z-50 flex w-full items-center justify-between gap-2",children:s.jsxs("div",{className:"flex w-full flex-wrap items-end justify-end gap-2",children:[u&&(e==null?void 0:e.metadata)!==void 0?s.jsxs(N,{disabled:_||!t,tabIndex:-1,variant:"outline",size:"sm",className:"z-50 gap-2 whitespace-nowrap","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),d(!0);const p=M(e.id);if(p){if(!F(p)){x({title:"Error",list:["This flow doesn't have a playground."]}),d(!1);return}R(e.id),k(!0),d(!1)}else q().then(r=>{if(!F(r)){x({title:"Error",list:["This flow doesn't have a playground."]}),d(!1);return}A(r),k(!0),d(!1)})},children:[_?s.jsx(K,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(c,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id):void 0,e.liked_by_count!=null&&s.jsxs("div",{className:"flex gap-0.5",children:[o&&(e==null?void 0:e.metadata)!==void 0?s.jsx(b,{content:t?"Delete":"Please review your API key.",children:s.jsx(je,{onConfirm:o,children:s.jsx(N,{variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),children:s.jsx(c,{"data-testid":`delete-${W(e.name)}`,name:"Trash2",className:v("h-5 w-5",t?"":"text-ring")})})})}):s.jsx(b,{content:t?"Like":"Please review your API key.",children:s.jsx(N,{disabled:re,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),onClick:()=>{t&&ie()},"data-testid":`like-${e.name}`,children:s.jsx(c,{name:"Heart",className:v("h-5 w-5",C?"fill-destructive stroke-destructive":"",t?"":"text-ring")})})}),s.jsx(b,{content:t?"Install Locally":"Please review your API key.",children:s.jsx(N,{disabled:j,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed")+(j?"":" p-0.5"),onClick:()=>{j||!t||oe()},"data-testid":`install-${e.name}`,children:s.jsx(c,{name:j?"Loader2":"Plus",className:v(j?"h-5 w-5 animate-spin":"h-5 w-5",t?"":"text-ring")})})})]}),u&&(e==null?void 0:e.metadata)===void 0&&s.jsxs(N,{disabled:_||!t,tabIndex:-1,variant:"primary",size:"sm",className:"gap-2 whitespace-nowrap bg-muted","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),d(!0);const p=M(e.id);if(p){if(!F(p)){x({title:"Error",list:["This flow doesn't have a playground."]}),d(!1);return}R(e.id),k(!0),d(!1)}else q().then(r=>{if(!F(r)){x({title:"Error",list:["This flow doesn't have a playground."]}),d(!1);return}A(r),k(!0),d(!1)})},children:[_?s.jsx(K,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(c,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id)]})})})]}),D&&s.jsx(ge,{cleanOnClose:!0,open:D,setOpen:k,children:s.jsx(s.Fragment,{})})]})}const Le=({loading:e,divClasses:t,onChange:a,onClick:l,value:i,onKeyDown:o})=>{const u=window.location.pathname,m=f(y=>y.allFlows),w=e||!m,x=()=>u.includes("flows")?"Search Flows":u.includes("components")?"Search Components":"Search Flows and Components";return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`${t||"relative h-12 w-[60%]"}`,children:[s.jsx(ke,{"data-testid":"search-store-input",disabled:w,placeholder:x(),className:"absolute h-12 pl-5 pr-12",onChange:a,onKeyDown:o,value:i}),s.jsx("button",{onClick:l,disabled:e,className:"absolute bottom-0 right-4 top-0 my-auto h-6 cursor-pointer stroke-1 text-muted-foreground","data-testid":"search-store-button",children:s.jsx(c,{name:e?"Loader2":"Search",className:e?"animate-spin cursor-not-allowed":""})})]})})},He=Le;export{qe as C,He as I,Ue as S};
