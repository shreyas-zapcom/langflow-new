import{j as o,aw as ee,ax as P,aV as z,aW as ae,az as f,u as _,h as U,aX as ne,aY as oe,aB as se,aC as re,aZ as te,r as T,ay as V,f as B,a_ as $,I as L,a$ as le,aI as de,aH as ce}from"./index-CZbEahd3.js";import{H as ie}from"./index-CTa-Zuxc.js";import{I as fe}from"./input-Be_w8K09.js";const ue=({items:u,pathname:d})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:u.map(r=>o.jsx(ee,{to:r.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${r.title}`,className:P(z({variant:"ghost"}),d===r.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[r.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:r.title})]},r.title)}))}),pe=ue;function me(u){ae(u).then(d=>{const t=f.getState().folders.find(h=>h.id===u);d.folder_name=(t==null?void 0:t.name)||"folder",d.folder_description=(t==null?void 0:t.description)||"";const j=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(d))}`,l=document.createElement("a");l.href=j,l.download=`${d.folder_name}.json`,l.click()})}const he=(u,d)=>{const r=f(a=>a.setFolderDragging),t=f(a=>a.setFolderIdDragging),j=_(a=>a.setErrorData),l=f(a=>a.refreshFolders),h=U(a=>a.flows),c=a=>{d&&d(a)},N=async a=>{if(a.dataTransfer.types.some(s=>s==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=a.dataTransfer.files[0];s.type==="application/json"?C(s):j({title:se,list:[re]})}},i=(a,s)=>{a.preventDefault(),a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s)},w=(a,s)=>{a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s),a.preventDefault()},y=a=>{a.preventDefault(),a.target===a.currentTarget&&(r(!1),t(""))},k=(a,s)=>{var g,F;if((g=a==null?void 0:a.dataTransfer)!=null&&g.getData("flow")){const v=JSON.parse((F=a==null?void 0:a.dataTransfer)==null?void 0:F.getData("flow"));if(v){x(v.id,s);return}}a.preventDefault(),N(a)},x=(a,s)=>{const g=h.find(I=>I.id===a);if(!g)throw new Error("Flow not found");const F={...g,folder_id:s},v=ne(F,h);F.name=v,r(!1),t(""),oe(F).then(()=>{l(),c(s)})},C=a=>{const s=new FormData;s.append("file",a),r(!1),t(""),te(s,u).then(()=>{l(),c(u)})};return{dragOver:i,dragEnter:w,dragLeave:y,onDrop:k}},ge=({pathname:u,handleChangeFolder:d,handleDeleteFolder:r})=>{var R;const t=T.useRef(null),j=f(e=>e.setFolders),l=f(e=>e.folders),[h,c]=T.useState({}),N=U(e=>e.takeSnapshot),[i,w]=T.useState(l.map(e=>({name:e.name,edit:!1}))),y=f(e=>e.uploadFolder),k=u.split("/"),x=u.split("/").length<4,C=f(e=>e.myCollectionId),a=f(e=>e.folderIdDragging),s=f(e=>e.refreshFolders),g=e=>x&&e===C?!0:k.includes(e),F=V(),v=((R=F==null?void 0:F.state)==null?void 0:R.folderId)??C,I=f(e=>e.getFolderById),A=_(e=>e.setErrorData),H=_(e=>e.setSuccessData),W=()=>{I(v)},{dragOver:J,dragEnter:K,dragLeave:M,onDrop:G}=he(v,W),X=()=>{y(v).then(()=>{I(v),H({title:"Uploaded successfully"})}).catch(e=>{console.log(e),A({title:"Error on upload",list:[e.response.data]})})},Y=e=>{me(e)};function Z(){de({name:"New Folder",parent_id:null,description:""}).then(e=>{s()})}function q(e,E){const{target:{value:D}}=e;c(n=>({...n,[E]:D}))}T.useEffect(()=>{l.map(e=>({name:e.name,edit:!1}))},[l]);const Q=async e=>{var D,n;const E=i.map(p=>p.name===e.name?{name:e.name,edit:!1}:{name:p.name,edit:!1});if(w(E),h[e.name].trim()!==""){c(S=>({...S,[e.name]:h[e.name]}));const p={...e,name:h[e.name],flows:((D=e.flows)==null?void 0:D.length)>0?e.flows:[],components:((n=e.components)==null?void 0:n.length)>0?e.components:[]},m=await ce(p,e.id),b=l.findIndex(S=>S.id===m.id),O=[...l];O[b]=m,j(O),c({}),w(l.map(S=>({name:S.name,edit:!1})))}else c(p=>({...p,[e.name]:e.name}))};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(B,{variant:"primary",size:"icon",className:"px-2",onClick:Z,"data-testid":"add-folder-button",children:o.jsx($,{name:"FolderPlus",className:"w-4"})}),o.jsx(B,{variant:"primary",size:"icon",className:"px-2",onClick:X,"data-testid":"upload-folder-button",children:o.jsx($,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:l.map((e,E)=>{const D=i==null?void 0:i.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>J(n,e.id),onDragEnter:n=>K(n,e.id),onDragLeave:M,onDrop:n=>G(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:P(z({variant:"ghost"}),g(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",a===e.id?"bg-border":""),onClick:()=>d(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var p;if(e.name!=="My Projects"){if(h[e.name]||c({[e.name]:e.name}),(p=i.find(m=>m.name===e.name))!=null&&p.name){const m=i.map(b=>b.name===e.name?{name:e.name,edit:!0}:{name:b.name,edit:!1});w(m),N(),n.stopPropagation(),n.preventDefault();return}w(m=>[...m,{name:e.name,edit:!0}]),c(m=>({...m,[e.name]:e.name})),N(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-2",children:[o.jsx(L,{name:"folder",className:"mr-2 w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),D!=null&&D.edit?o.jsx("div",{children:o.jsx(fe,{className:"w-36",onChange:n=>{q(n,e.name)},ref:t,onKeyDown:n=>{var p;if(n.key==="Escape"){const m=i.map(b=>b.name===e.name?{name:e.name,edit:!1}:{name:b.name,edit:!1});w(m),c({}),w(l.map(b=>({name:b.name,edit:!1})))}n.key==="Enter"&&((p=t.current)==null||p.blur()),le(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var n;((n=t.current)==null?void 0:n.value)!==e.name?Q(e):D.edit=!1},value:h[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),E>0&&o.jsx(B,{"data-testid":"btn-delete-folder",className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{r(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",size:"icon",children:o.jsx(L,{name:"trash",className:"w-4 stroke-[1.5] p-0"})}),o.jsx(B,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{Y(e.id),n.stopPropagation(),n.preventDefault()},unstyled:!0,children:o.jsx(L,{name:"Download",className:"w-4 stroke-[1.5] text-white"})})]})},e.id)})})})]})},Fe=ge;function De({className:u,items:d,handleChangeFolder:r,handleEditFolder:t,handleDeleteFolder:j,...l}){const c=V().pathname,N=f(x=>x.isLoadingFolders),i=f(x=>x.folders),y=["folder","components","flows","all"].some(x=>c.includes(x)),k=d.length>0?o.jsx(pe,{items:d,pathname:c}):!N&&(i==null?void 0:i.length)>0&&y?o.jsx(Fe,{pathname:c,handleChangeFolder:r,handleDeleteFolder:j}):null;return o.jsx("nav",{className:P(u),...l,children:o.jsx(ie,{children:k})})}export{De as S};
