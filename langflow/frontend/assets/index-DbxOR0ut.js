import{av as je,aw as we,ax as ve,r as m,j as e,c as E,I as b,ay as Y,u as _,az as g,aA as Se,aB as Ce,aC as ye,i as w,z as P,S as A,g as T,au as be,aD as De}from"./index-BMduUo-e.js";import{C as Ne,u as Q,a as Fe,F as Le,S as X,I as ke}from"./index-BRRoJwnQ.js";import{P as Ee}from"./index-KTGLGf7v.js";import{D as Te}from"./index-RP3kj6uB.js";import{N as _e}from"./index-BnLFsVYy.js";import{C as Me}from"./checkbox-CDPHlcmT.js";import"./index-CTW3Zofm.js";import"./index-CSrcWjzj.js";import"./index-ChUOwpXi.js";import"./input-0yNO_Rdy.js";import"./addNewVariableButton-oiOAsQtq.js";import"./popover-Ig0gGBrk.js";import"./index-DBQGxdl2.js";import"./label-D0S6d1zR.js";import"./select-NgJ71qQw.js";import"./index-B-hPoVZM.js";const Oe=t=>{const{mutate:o}=je(),r=async l=>(await we.post(`${ve("FLOWS")}/download/`,l.flow_ids,{responseType:"blob"})).data;return o(["usePostDownloadMultipleFlows"],async l=>await r(l),t)};function Ue({onFileDrop:t,children:o,dragMessage:r}){const[i,l]=m.useState(!1);m.useEffect(()=>{const d=()=>{document.visibilityState==="visible"&&l(!1)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]);const n=d=>{d.preventDefault(),d.dataTransfer.types.some(c=>c==="Files")&&t&&l(!0)},s=d=>{d.dataTransfer.types.some(c=>c==="Files")&&t&&l(!0),d.preventDefault()},u=d=>{d.preventDefault(),t&&l(!1)},p=d=>{d.preventDefault(),t&&t(d),l(!1)};return e.jsx("div",{onDragOver:n,onDragEnter:s,onDragLeave:u,onDrop:p,className:E("h-full w-full",i?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:i?e.jsxs(e.Fragment,{children:[e.jsx(b,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),r||"Drop your file here"]}):o})}const Ie=(t,o)=>{var d;const r=Y(),i=_(c=>c.setSuccessData),l=_(c=>c.setErrorData),n=g(c=>c.getFolderById),s=(d=r==null?void 0:r.state)==null?void 0:d.folderId,u=g(c=>c.myCollectionId);return[c=>{if(c.preventDefault(),c.dataTransfer.types.some(f=>f==="Files")){const f=c.dataTransfer.files.item(0);if(f.type==="application/json"){const x=new FileReader;x.onload=h=>{const v=h.target.result,N=JSON.parse(v).is_component;t({newProject:!0,file:f,isComponent:o==="all"?null:o==="component"}).then(()=>{i({title:`${N?"Component":"Flow"} uploaded successfully`}),n(s||u)}).catch(F=>{l({title:Se,list:[F]})})},x.readAsText(f)}else l({title:Ce,list:[ye]})}}]},Re=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},Ae=(t,o)=>{const r=o==="component",i=(n,s)=>{const u=(n==null?void 0:n.updated_at)||(n==null?void 0:n.date_created),p=(s==null?void 0:s.updated_at)||(s==null?void 0:s.date_created);return u&&p?new Date(p).getTime()-new Date(u).getTime():u?1:p?-1:0},l=o==="all"?t:t==null?void 0:t.filter(n=>((n==null?void 0:n.is_component)??!1)===r);return(l==null?void 0:l.sort(i))??[]},Pe=({})=>{w(r=>r.addFlow),P();const[t,o]=m.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(_e,{open:t,setOpen:o}),e.jsx("button",{onClick:()=>{o(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},$e=({handleSelectAll:t,handleDelete:o,handleDuplicate:r,handleExport:i,disableFunctions:l,setShouldSelectAll:n,shouldSelectAll:s})=>{const u=()=>{t(s),n(p=>!p)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:u,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Me,{checked:!s,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(A,{content:l?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(T,{unstyled:!0,onClick:i,disabled:l,children:e.jsx(b,{name:"FileDown",className:E("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(A,{content:l?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(T,{unstyled:!0,onClick:r,disabled:l,children:e.jsx(b,{name:"Copy",className:E("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(A,{content:l?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(T,{unstyled:!0,onClick:o,disabled:l,children:e.jsx(b,{name:"Trash2",className:E("h-5 w-5 text-primary transition-all",l?"":"hover:text-status-red")})})})})]})]})})},Be=({item:t,type:o,isLoading:r,control:i})=>{const l=P(),n=t.is_component??!1,s=`/flow/${t.id}`,u=`edit-flow-button-${t.id}`,p=g(v=>v.folderUrl),d=g(v=>v.myCollectionId),f=p!=null&&p!==""?p:d,x=()=>{n||l(s,{state:{folderId:f}})},h=()=>n?null:e.jsx(be,{to:s,children:e.jsxs(T,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":u,children:[e.jsx(b,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})});return e.jsx(Ne,{data:{is_component:n,...t},disabled:r,"data-testid":u,button:h(),onClick:n?void 0:x,playground:!n,control:i})},ze=(t,o,r,i,l,n,s,u,p,d,c)=>({handleDeleteMultiple:m.useCallback(()=>{o(t).then(()=>{d([]),c(null),r(),i(!0),(!l||l===n)&&s(l||n),u({title:"Selected items deleted successfully"})}).catch(()=>{p({title:"Error deleting items",list:["Please try again"]})})},[t,o,r,i,l,n,s,u,p])}),We=(t,o)=>m.useMemo(()=>{const i=n=>({all:"item",component:"component",flow:"flow"})[n]||"",l=n=>({all:"items",component:"components",flow:"flows"})[n]||"";return(t==null?void 0:t.length)===1?i(o):l(o)},[t,o]),He=(t,o,r)=>{m.useEffect(()=>{const l=De(t||[]).filter(n=>n.name.toLowerCase().includes(o.toLowerCase())||n.description.toLowerCase().includes(o.toLowerCase()));r(o===""?t:l)},[t,o,r])},Je=(t,o,r,i,l,n,s,u,p,d,c,f)=>({handleDuplicate:m.useCallback(()=>{Promise.all(t.map(h=>o(!0,r.find(v=>v.id===h)))).then(()=>{i(),l(!0),(!n||n===s)&&u(n||s),p({title:`${f} duplicated successfully`}),d([]),c(!1)})},[t,o,r,i,l,n,s,u,p,d,c,f])}),Ge=(t,o,r)=>({handleSelectAll:m.useCallback(l=>{const n=t==null?void 0:t.map(s=>s.id);if(l){Object.keys(o()).forEach(s=>{n!=null&&n.includes(s)&&r(s,!0)});return}Object.keys(o()).forEach(s=>{r(s,!1)})},[t,o,r])}),qe=(t,o,r,i,l)=>({handleSelectOptionsChange:m.useCallback(s=>{if(!((t==null?void 0:t.length)>0)){o({title:"No items selected",list:["Please select items to delete"]});return}s==="delete"?r(!0):s==="duplicate"?i():s==="export"&&l()},[t,o,r,i,l])}),Ke=(t,o)=>{m.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const r=Object.keys(t).filter(i=>t[i]===!0);o(r)},[t,o])};function Ze({type:t="all"}){var K;const o=w(a=>a.uploadFlow),r=w(a=>a.removeFlow),i=w(a=>a.isLoading),l=w(a=>a.setAllFlows),n=w(a=>a.allFlows),s=g(a=>{var S;return(S=a.selectedFolder)==null?void 0:S.flows}),u=_(a=>a.setSuccessData),p=_(a=>a.setErrorData),[d,c]=m.useState(!1),f=w(a=>a.searchFlowsComponents),x=w(a=>a.setSelectedFlowsComponentsCards),h=w(a=>a.selectedFlowsComponentsCards),[v]=Ie(o,t),[D,N]=m.useState(20),[F,$]=m.useState(1),L=Y(),M=Ae(n,t),B=(F-1)*D,V=B+D,j=M==null?void 0:M.slice(B,V),ee=Re(t),C=(K=L==null?void 0:L.state)==null?void 0:K.folderId,O=g(a=>a.getFolderById),U=g(a=>a.myCollectionId),z=g(a=>a.getFoldersApi),te=g(a=>a.setFolderUrl),ne=w(a=>a.addFlow),W=g(a=>a.isLoadingFolders),se=g(a=>a.setSelectedFolder),[le,H]=m.useState(!0),J=m.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);m.useEffect(()=>{te(C??""),x([]),k(!1),O(C||U)},[L]),He(s,f,l);const G=()=>{$(1),N(20)},{getValues:oe,control:q,setValue:ae}=Q(),re=Fe({control:q}),ce=Q(),{handleSelectAll:k}=Ge(s,oe,ae),{handleDuplicate:ie}=Je(h,ne,n,G,z,C,U,O,u,x,k,J),{mutate:de}=Oe(),ue=()=>{de({flow_ids:h},{onSuccess:a=>{const S=n.find(ge=>ge.id===h[0]),he=h.length>1?"application/zip":"application/json",Z=h.length>1?"_langflow_flows.zip":`${S.name}.json`,xe=new Blob([a],{type:he}),y=document.createElement("a");y.href=window.URL.createObjectURL(xe);let R=new Date().toISOString().replace(/[:.]/g,"");R=R.replace(/-/g,"").replace(/T/g,"").replace(/Z/g,""),y.download=h.length>1?`${R}${Z}`:`${Z}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),u({title:`${J} exported successfully`}),x([]),k(!1),H(!0)}})},{handleSelectOptionsChange:I}=qe(h,p,c,ie,ue),{handleDeleteMultiple:pe}=ze(h,r,G,z,C,U,O,u,p,l,se);Ke(re,x);const me=We(h,t),fe=()=>{var a;return t==="all"?n==null?void 0:n.length:(a=n==null?void 0:n.filter(S=>(S.is_component??!1)===(t==="component")))==null?void 0:a.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(n==null?void 0:n.length)>0&&e.jsx($e,{shouldSelectAll:le,setShouldSelectAll:H,handleDelete:()=>I("delete"),handleSelectAll:k,handleDuplicate:()=>I("duplicate"),handleExport:()=>I("export"),disableFunctions:!((h==null?void 0:h.length)>0)})}),e.jsx(Ue,{onFileDrop:v,dragMessage:`Drag your ${ee} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between","data-testid":"cards-wrapper",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!i&&!W&&(j==null?void 0:j.length)===0?e.jsx(Pe,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:i===!1&&(j==null?void 0:j.length)>0&&W===!1?e.jsx(e.Fragment,{children:j==null?void 0:j.map(a=>m.createElement(Le,{...ce,key:a.id},e.jsx("form",{children:e.jsx(Be,{item:a,type:t,isLoading:i,control:q})})))}):e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(X,{})]})})}),!i&&(j==null?void 0:j.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(Ee,{storeComponent:!0,pageIndex:F,pageSize:D,rowsCount:[10,20,50,100],totalRowsCount:fe(),paginate:(a,S)=>{$(S),N(a)}})})]})}),d&&e.jsx(Te,{open:d,setOpen:c,onConfirm:pe,description:me,children:e.jsx(e.Fragment,{})})]})}const Qe=({tabsOptions:t,setActiveTab:o,loading:r,tabActive:i})=>{const l=P(),n=g(c=>c.folderUrl),s=g(c=>c.myCollectionId),p=n!=null&&n!==""?n:s,d=c=>{const f=window.location.pathname;let x="";switch(c){case"Flows":x=f.replace(/components|all/,"flows");break;case"Components":x=f.replace(/flows|all/,"components");break;default:x=f.replace(/flows|components/,"all");break}l(x,{state:{folderId:p}})};return m.useEffect(()=>{const c=window.location.pathname;c.includes("components")?o("Components"):c.includes("flows")?o("Flows"):o("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((c,f)=>e.jsx("button",{"data-testid":`${c}-button-store`,disabled:r,onClick:()=>{d(c)},className:(i===c?"border-b-2 border-primary p-3":"border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(r?" cursor-not-allowed":""),children:c},f))})})},Xe=({})=>{const t=w(s=>s.isLoading),[o,r]=m.useState("Flows"),[i,l]=m.useState(""),n=w(s=>s.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(ke,{loading:t,value:i,onChange:s=>{n(s.target.value),l(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&n(i)}}),e.jsx(Qe,{tabsOptions:["All","Flows","Components"],setActiveTab:r,loading:t,tabActive:o})]})})},ft=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Xe,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(Ze,{type:t},t)})]});export{ft as default};
